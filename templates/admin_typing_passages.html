<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Typing Passage - Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation Bar -->
    <nav class="bg-white shadow-lg border-b">
        <div class="w-full px-2 py-3">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <a href="{{ url_for('admin_content') }}" class="text-blue-600 hover:text-blue-800">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                        </svg>
                    </a>
                    <h1 class="text-xl font-bold text-gray-800">Add Typing Passage</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-600">
                        Welcome, <span class="font-medium">{{ session.username }}</span>
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 ml-2">{{ session.role.title() }}</span>
                    </span>
                    <a href="{{ url_for('logout') }}" class="bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700 text-sm">Logout</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="w-full px-2 py-8">
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                {% for message in messages %}
                    <div class="bg-green-50 border-l-4 border-green-400 text-green-800 px-6 py-4 rounded-lg mb-6 shadow-lg">
                        <div class="flex items-center">
                            <svg class="w-5 h-5 mr-3 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <span class="font-medium">{{ message }}</span>
                        </div>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Typing Passage Form -->
        <div class="max-w-4xl mx-auto">
            <div class="bg-white rounded-lg shadow-lg border border-gray-200">
                <div class="p-6 border-b border-gray-200">
                    <h2 class="text-xl font-bold text-gray-800">Add Typing Passage</h2>
                    <p class="text-sm text-gray-600 mt-2">Create a new typing passage for students to practice</p>
                </div>
                
                <form method="POST" enctype="multipart/form-data" class="p-6">
                    <!-- Title Field -->
                    <div class="mb-6">
                        <label for="title" class="block text-sm font-medium text-gray-700 mb-2">
                            Passage Title *
                        </label>
                        <input type="text" 
                               id="title" 
                               name="title" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500"
                               placeholder="Enter a descriptive title for the typing passage"
                               required>
                        <p class="text-xs text-gray-500 mt-1">This will be displayed to students when selecting passages</p>
                    </div>

                    <!-- Content Input Method Selection -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-3">
                            üìÑ Passage Content (Required)
                        </label>
                        <div class="mb-4">
                            <div class="flex space-x-4">
                                <label class="flex items-center">
                                    <input type="radio" name="text_input_method" value="direct" checked class="mr-2">
                                    <span class="text-sm font-medium">üìù Type directly</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="text_input_method" value="file" class="mr-2">
                                    <span class="text-sm font-medium">üìÅ Upload file</span>
                                </label>
                            </div>
                        </div>

                        <!-- Direct Text Input -->
                        <div id="direct-text-input" class="mb-4">
                            <label for="content" class="block text-sm font-medium text-gray-700 mb-2">
                                Enter Passage Content
                            </label>
                            <textarea id="content" 
                                      name="content" 
                                      rows="12"
                                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 resize-y"
                                      placeholder="Enter the text content that students will type..."
                                      style="min-height: 300px; resize: vertical;"></textarea>
                            <div class="flex justify-between items-center mt-2">
                                <p class="text-xs text-gray-500">Students will see this text and need to type it accurately</p>
                                <div class="text-xs text-gray-500">
                                    <span id="word-count">0</span> words | <span id="char-count">0</span> characters
                                </div>
                            </div>
                        </div>

                        <!-- File Upload -->
                        <div id="file-upload-input" class="mb-4" style="display: none;">
                            <label for="passage_file" class="block text-sm font-medium text-gray-700 mb-2">
                                Upload Passage File
                            </label>
                            <div class="upload-area rounded-xl p-8 text-center cursor-pointer border-2 border-dashed border-gray-300 hover:border-green-400 transition-colors">
                                <div class="space-y-4">
                                    <div class="w-16 h-16 bg-green-600 rounded-full flex items-center justify-center mx-auto shadow-lg">
                                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                        </svg>
                                    </div>
                                    <div class="text-gray-800">
                                        <label for="passage_file" class="cursor-pointer font-medium text-green-600 hover:text-green-500 transition-colors">
                                            <span>üì§ Upload passage file</span>
                                            <input id="passage_file" name="passage_file" type="file" accept=".txt,.docx,.odt" class="sr-only">
                                        </label>
                                        <span class="text-gray-600"> or drag and drop</span>
                                    </div>
                                    <p class="text-sm text-gray-600">üìÑ Supports: .txt, .docx, .odt files (up to 10MB)</p>
                                </div>
                            </div>
                            <p class="text-xs text-gray-600 mt-2">Upload a file containing the text that students should practice typing</p>
                        </div>
                    </div>

                    <!-- Guidelines -->
                    <div class="mb-6 p-4 bg-green-50 border border-green-200 rounded-md">
                        <h4 class="text-sm font-medium text-green-800 mb-2">Content Guidelines:</h4>
                        <ul class="text-sm text-green-700 space-y-1">
                            <li>‚Ä¢ Use proper punctuation and capitalization</li>
                            <li>‚Ä¢ Keep passages between 50-500 words for optimal practice</li>
                            <li>‚Ä¢ Avoid special characters that might be difficult to type</li>
                            <li>‚Ä¢ Use clear, well-structured sentences</li>
                            <li>‚Ä¢ Consider the difficulty level appropriate for your students</li>
                            <li>‚Ä¢ Proofread for accuracy before saving</li>
                        </ul>
                    </div>

                    <!-- Sample Passages -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Quick Sample Passages
                        </label>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div class="p-3 bg-gray-50 border border-gray-200 rounded-md">
                                <h5 class="text-xs font-medium text-gray-700 mb-1">Beginner Sample</h5>
                                <button type="button" onclick="loadSample('beginner')" class="text-xs text-blue-600 hover:text-blue-800">Load Sample</button>
                                <p class="text-xs text-gray-600 mt-1">Simple sentences with common words</p>
                            </div>
                            <div class="p-3 bg-gray-50 border border-gray-200 rounded-md">
                                <h5 class="text-xs font-medium text-gray-700 mb-1">Advanced Sample</h5>
                                <button type="button" onclick="loadSample('advanced')" class="text-xs text-blue-600 hover:text-blue-800">Load Sample</button>
                                <p class="text-xs text-gray-600 mt-1">Complex sentences with varied vocabulary</p>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Buttons -->
                    <div class="flex justify-end space-x-4">
                        <a href="{{ url_for('admin_content') }}" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                            Cancel
                        </a>
                        <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                            <svg class="inline-block w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                            Add Typing Passage
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Text input method toggle
        const textInputRadios = document.querySelectorAll('input[name="text_input_method"]');
        const directTextInput = document.getElementById('direct-text-input');
        const fileUploadInput = document.getElementById('file-upload-input');

        textInputRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.value === 'direct') {
                    directTextInput.style.display = 'block';
                    fileUploadInput.style.display = 'none';
                    // Make direct text required
                    document.getElementById('content').required = true;
                    document.getElementById('passage_file').required = false;
                } else {
                    directTextInput.style.display = 'none';
                    fileUploadInput.style.display = 'block';
                    // Make file upload required
                    document.getElementById('content').required = false;
                    document.getElementById('passage_file').required = true;
                }
            });
        });

        // File upload enhancement
        document.getElementById('passage_file').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                // Update UI to show selected file
                const label = document.querySelector('label[for="passage_file"] span');
                label.innerHTML = `üìÑ ${file.name}`;
                
                // Update upload area appearance
                const uploadArea = document.querySelector('.upload-area');
                uploadArea.classList.remove('border-gray-300');
                uploadArea.classList.add('border-green-400');
                uploadArea.style.background = 'rgba(34, 197, 94, 0.1)';
            }
        });

        // Word and character counter
        const contentTextarea = document.getElementById('content');
        const wordCount = document.getElementById('word-count');
        const charCount = document.getElementById('char-count');

        function updateCounts() {
            const text = contentTextarea.value;
            const words = text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
            const characters = text.length;
            
            wordCount.textContent = words;
            charCount.textContent = characters;
        }

        contentTextarea.addEventListener('input', updateCounts);

        // Sample passage loader
        function loadSample(type) {
            const samples = {
                beginner: {
                    title: "Daily Morning Routine",
                    content: "Every morning I wake up at seven o'clock. I brush my teeth and wash my face with cold water. Then I eat breakfast with my family. We usually have toast, eggs, and fresh juice. After breakfast, I get dressed and pack my school bag. I walk to school with my friends. The fresh morning air makes me feel happy and ready for a new day."
                },
                advanced: {
                    title: "The Importance of Environmental Conservation",
                    content: "Environmental conservation has become increasingly crucial in our contemporary world, where industrialization and urbanization continue to accelerate at unprecedented rates. The delicate balance of ecosystems requires our immediate attention and proactive measures to ensure sustainable development. Scientists worldwide emphasize the significance of preserving biodiversity, reducing carbon emissions, and implementing renewable energy solutions. Through collective efforts and individual responsibility, we can mitigate the adverse effects of climate change and create a healthier planet for future generations."
                }
            };

            if (samples[type]) {
                document.getElementById('title').value = samples[type].title;
                document.getElementById('content').value = samples[type].content;
                updateCounts();
            }
        }

        // Auto-fill title based on first few words
        contentTextarea.addEventListener('blur', function() {
            const titleInput = document.getElementById('title');
            if (!titleInput.value && this.value) {
                const firstWords = this.value.split(' ').slice(0, 5).join(' ');
                titleInput.value = firstWords + (this.value.split(' ').length > 5 ? '...' : '');
            }
        });

        // Initialize counts
        updateCounts();
    </script>
</body>
</html>
